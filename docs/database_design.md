# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸

## æ¦‚è¦

æ ªä¾¡ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆä»•æ§˜æ›¸ã§ã™ã€‚  
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­è¨ˆç†å¿µï¼ˆ**å‹•ä½œå„ªå…ˆãƒ»ã‚·ãƒ³ãƒ—ãƒ«è¨­è¨ˆãƒ»å¾Œã‹ã‚‰æ‹¡å¼µ**ï¼‰ã«åŸºã¥ãã€æœ€å°é™ã®æ§‹æˆã‹ã‚‰é–‹å§‹ã—ã€å¿…è¦ã«å¿œã˜ã¦æ‹¡å¼µã—ã¦ã„ãæ–¹é‡ã§ã™ã€‚

## ç›®æ¬¡

- [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸)
  - [æ¦‚è¦](#æ¦‚è¦)
  - [ç›®æ¬¡](#ç›®æ¬¡)
  - [åŸºæœ¬æƒ…å ±](#åŸºæœ¬æƒ…å ±)
  - [ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ](#ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ)
    - [1. stocks\_daily ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ—¥è¶³ãƒ‡ãƒ¼ã‚¿ï¼‰](#1-stocks_daily-ãƒ†ãƒ¼ãƒ–ãƒ«æ—¥è¶³ãƒ‡ãƒ¼ã‚¿)
      - [ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©](#ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©)
      - [ã‚«ãƒ©ãƒ å®šç¾©](#ã‚«ãƒ©ãƒ å®šç¾©)
      - [åˆ¶ç´„](#åˆ¶ç´„)
        - [ä¸»ã‚­ãƒ¼åˆ¶ç´„](#ä¸»ã‚­ãƒ¼åˆ¶ç´„)
        - [ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„](#ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„)
        - [ãƒã‚§ãƒƒã‚¯åˆ¶ç´„](#ãƒã‚§ãƒƒã‚¯åˆ¶ç´„)
  - [ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ](#ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ)
    - [1. ä¸»ã‚­ãƒ¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆè‡ªå‹•ä½œæˆï¼‰](#1-ä¸»ã‚­ãƒ¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è‡ªå‹•ä½œæˆ)
    - [2. ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆè‡ªå‹•ä½œæˆï¼‰](#2-ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è‡ªå‹•ä½œæˆ)
    - [3. æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹](#3-æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹)
      - [éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹](#éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹)
      - [æ—¥ä»˜æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹](#æ—¥ä»˜æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹)
      - [è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆéŠ˜æŸ„+æ—¥ä»˜é™é †ï¼‰](#è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹éŠ˜æŸ„æ—¥ä»˜é™é †)
  - [SQLAlchemy ãƒ¢ãƒ‡ãƒ«å®šç¾©](#sqlalchemy-ãƒ¢ãƒ‡ãƒ«å®šç¾©)
    - [Pythonå®Ÿè£…ä¾‹](#pythonå®Ÿè£…ä¾‹)
  - [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–)
    - [1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ](#1-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ)
    - [2. ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ](#2-ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ)
  - [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹è€ƒæ…®äº‹é …](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹è€ƒæ…®äº‹é …)
    - [MVPæ®µéšŽã§ã®æ–¹é‡](#mvpæ®µéšŽã§ã®æ–¹é‡)
    - [å°†æ¥ã®æ‹¡å¼µæ¡ˆï¼ˆå¿…è¦ã«ãªã£ã¦ã‹ã‚‰æ¤œè¨Žï¼‰](#å°†æ¥ã®æ‹¡å¼µæ¡ˆå¿…è¦ã«ãªã£ã¦ã‹ã‚‰æ¤œè¨Ž)
  - [ãƒ‡ãƒ¼ã‚¿å®¹é‡è¦‹ç©ã‚‚ã‚Š](#ãƒ‡ãƒ¼ã‚¿å®¹é‡è¦‹ç©ã‚‚ã‚Š)
    - [1éŠ˜æŸ„ã‚ãŸã‚Šã®ãƒ‡ãƒ¼ã‚¿é‡](#1éŠ˜æŸ„ã‚ãŸã‚Šã®ãƒ‡ãƒ¼ã‚¿é‡)
    - [100éŠ˜æŸ„ã®å ´åˆ](#100éŠ˜æŸ„ã®å ´åˆ)
  - [ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»é‹ç”¨](#ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é‹ç”¨)
    - [MVPæ®µéšŽã§ã®æ–¹é‡](#mvpæ®µéšŽã§ã®æ–¹é‡-1)
    - [å°†æ¥ã®é‹ç”¨è¨ˆç”»ï¼ˆå¿…è¦ã«ãªã£ã¦ã‹ã‚‰ï¼‰](#å°†æ¥ã®é‹ç”¨è¨ˆç”»å¿…è¦ã«ãªã£ã¦ã‹ã‚‰)
  - [ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿](#ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿)
    - [ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŒ¿å…¥ä¾‹](#ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŒ¿å…¥ä¾‹)
  - [å®Ÿè£…å„ªå…ˆåº¦](#å®Ÿè£…å„ªå…ˆåº¦)
    - [å„ªå…ˆåº¦: é«˜ï¼ˆMVPå¿…é ˆï¼‰](#å„ªå…ˆåº¦-é«˜mvpå¿…é ˆ)
    - [å„ªå…ˆåº¦: ä¸­ï¼ˆå‹•ä½œç¢ºèªå¾Œï¼‰](#å„ªå…ˆåº¦-ä¸­å‹•ä½œç¢ºèªå¾Œ)
    - [å„ªå…ˆåº¦: ä½Žï¼ˆå¿…è¦ã«ãªã£ã¦ã‹ã‚‰ï¼‰](#å„ªå…ˆåº¦-ä½Žå¿…è¦ã«ãªã£ã¦ã‹ã‚‰)
  - [è¤‡æ•°æ™‚é–“è»¸å¯¾å¿œï¼ˆå°†æ¥æ‹¡å¼µï¼‰](#è¤‡æ•°æ™‚é–“è»¸å¯¾å¿œå°†æ¥æ‹¡å¼µ)
    - [yfinanceã§å¯¾å¿œå¯èƒ½ãªæ™‚é–“è»¸](#yfinanceã§å¯¾å¿œå¯èƒ½ãªæ™‚é–“è»¸)
    - [å°†æ¥ã®ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆæ¡ˆ](#å°†æ¥ã®ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆæ¡ˆ)
      - [åˆ†è¶³ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå°†æ¥æ‹¡å¼µï¼‰](#åˆ†è¶³ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«å°†æ¥æ‹¡å¼µ)
      - [é€±è¶³ãƒ»æœˆè¶³ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå°†æ¥æ‹¡å¼µï¼‰](#é€±è¶³æœˆè¶³ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«å°†æ¥æ‹¡å¼µ)
    - [è¨­è¨ˆæ–¹é‡](#è¨­è¨ˆæ–¹é‡)
      - [MVPæ®µéšŽï¼ˆç¾åœ¨ï¼‰](#mvpæ®µéšŽç¾åœ¨)
      - [å°†æ¥æ‹¡å¼µæ™‚](#å°†æ¥æ‹¡å¼µæ™‚)
    - [æ‹¡å¼µæ™‚ã®è€ƒæ…®äº‹é …](#æ‹¡å¼µæ™‚ã®è€ƒæ…®äº‹é …)
      - [ãƒ‡ãƒ¼ã‚¿é‡](#ãƒ‡ãƒ¼ã‚¿é‡)
      - [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹)
      - [APIè¨­è¨ˆã¸ã®å½±éŸ¿](#apiè¨­è¨ˆã¸ã®å½±éŸ¿)
  - [ã¾ã¨ã‚](#ã¾ã¨ã‚)
    - [ðŸŽ¯ **å€‹äºº+AIé–‹ç™ºã§ã®ã‚·ãƒ³ãƒ—ãƒ«DBè¨­è¨ˆ**](#-å€‹äººaié–‹ç™ºã§ã®ã‚·ãƒ³ãƒ—ãƒ«dbè¨­è¨ˆ)
      - [è¨­è¨ˆæ–¹é‡](#è¨­è¨ˆæ–¹é‡-1)
      - [é¿ã‘ã‚‹ã¹ãéŽåº¦ãªè¨­è¨ˆ](#é¿ã‘ã‚‹ã¹ãéŽåº¦ãªè¨­è¨ˆ)
      - [æˆåŠŸã®æŒ‡æ¨™](#æˆåŠŸã®æŒ‡æ¨™)

## åŸºæœ¬æƒ…å ±

- **DBMS**: PostgreSQL
- **æ–‡å­—ã‚³ãƒ¼ãƒ‰**: UTF-8
- **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³**: Asia/Tokyo (JST)
- **é–‹ç™ºæ–¹é‡**: MVPæœ€å„ªå…ˆã€ã‚·ãƒ³ãƒ—ãƒ«æ§‹æˆ

## ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ

### 1. stocks_daily ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ—¥è¶³ãƒ‡ãƒ¼ã‚¿ï¼‰

æ—¥è¶³æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹ãƒ¡ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã™ã€‚

#### ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©

```sql
CREATE TABLE stocks_daily (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(20) NOT NULL,
    date DATE NOT NULL,
    open DECIMAL(10,2) NOT NULL,
    high DECIMAL(10,2) NOT NULL,
    low DECIMAL(10,2) NOT NULL,
    close DECIMAL(10,2) NOT NULL,
    volume BIGINT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

#### ã‚«ãƒ©ãƒ å®šç¾©

| ã‚«ãƒ©ãƒ å     | ãƒ‡ãƒ¼ã‚¿åž‹                 | NULL     | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ        | èª¬æ˜Ž                     |
| ------------ | ------------------------ | -------- | ----------------- | ------------------------ |
| `id`         | SERIAL                   | NOT NULL | AUTO_INCREMENT    | ä¸»ã‚­ãƒ¼ã€è‡ªå‹•æŽ¡ç•ª         |
| `symbol`     | VARCHAR(20)              | NOT NULL | -                 | éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹ï¼š7203.Tï¼‰ |
| `date`       | DATE                     | NOT NULL | -                 | å–å¼•æ—¥ï¼ˆYYYY-MM-DDï¼‰     |
| `open`       | DECIMAL(10,2)            | NOT NULL | -                 | å§‹å€¤                     |
| `high`       | DECIMAL(10,2)            | NOT NULL | -                 | é«˜å€¤                     |
| `low`        | DECIMAL(10,2)            | NOT NULL | -                 | å®‰å€¤                     |
| `close`      | DECIMAL(10,2)            | NOT NULL | -                 | çµ‚å€¤                     |
| `volume`     | BIGINT                   | NOT NULL | -                 | å‡ºæ¥é«˜                   |
| `created_at` | TIMESTAMP WITH TIME ZONE | NOT NULL | CURRENT_TIMESTAMP | ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ—¥æ™‚         |
| `updated_at` | TIMESTAMP WITH TIME ZONE | NOT NULL | CURRENT_TIMESTAMP | ãƒ¬ã‚³ãƒ¼ãƒ‰æ›´æ–°æ—¥æ™‚         |

#### åˆ¶ç´„

##### ä¸»ã‚­ãƒ¼åˆ¶ç´„
```sql
CONSTRAINT pk_stocks_daily PRIMARY KEY (id)
```

##### ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„
```sql
CONSTRAINT uk_stocks_daily_symbol_date UNIQUE (symbol, date)
```
- åŒä¸€éŠ˜æŸ„ã®åŒä¸€æ—¥ä»˜ã®ãƒ‡ãƒ¼ã‚¿ã®é‡è¤‡ã‚’é˜²ã

##### ãƒã‚§ãƒƒã‚¯åˆ¶ç´„
```sql
CONSTRAINT ck_stocks_daily_prices CHECK (
    open >= 0 AND high >= 0 AND low >= 0 AND close >= 0
),
CONSTRAINT ck_stocks_daily_volume CHECK (volume >= 0),
CONSTRAINT ck_stocks_daily_price_logic CHECK (
    high >= low AND 
    high >= open AND 
    high >= close AND 
    low <= open AND 
    low <= close
)
```

## ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ

### 1. ä¸»ã‚­ãƒ¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆè‡ªå‹•ä½œæˆï¼‰
```sql
-- è‡ªå‹•ä½œæˆã•ã‚Œã‚‹ãŸã‚æ˜Žç¤ºçš„ãªä½œæˆä¸è¦
-- CREATE UNIQUE INDEX idx_stocks_daily_pk ON stocks_daily (id);
```

### 2. ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆè‡ªå‹•ä½œæˆï¼‰
```sql
-- ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã«ã‚ˆã‚Šè‡ªå‹•ä½œæˆã•ã‚Œã‚‹ãŸã‚æ˜Žç¤ºçš„ãªä½œæˆä¸è¦
-- CREATE UNIQUE INDEX idx_stocks_daily_symbol_date ON stocks_daily (symbol, date);
```

### 3. æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

#### éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
```sql
CREATE INDEX idx_stocks_daily_symbol ON stocks_daily (symbol);
```
- **ç”¨é€”**: ç‰¹å®šéŠ˜æŸ„ã®ãƒ‡ãƒ¼ã‚¿æ¤œç´¢
- **å¯¾è±¡ã‚¯ã‚¨ãƒª**: `SELECT * FROM stocks_daily WHERE symbol = '7203.T'`

#### æ—¥ä»˜æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
```sql
CREATE INDEX idx_stocks_daily_date ON stocks_daily (date);
```
- **ç”¨é€”**: ç‰¹å®šæ—¥ä»˜ãƒ»æœŸé–“ã®ãƒ‡ãƒ¼ã‚¿æ¤œç´¢
- **å¯¾è±¡ã‚¯ã‚¨ãƒª**: `SELECT * FROM stocks_daily WHERE date >= '2024-01-01'`

#### è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆéŠ˜æŸ„+æ—¥ä»˜é™é †ï¼‰
```sql
CREATE INDEX idx_stocks_daily_symbol_date_desc ON stocks_daily (symbol, date DESC);
```
- **ç”¨é€”**: éŠ˜æŸ„åˆ¥ã®æœ€æ–°ãƒ‡ãƒ¼ã‚¿å–å¾—
- **å¯¾è±¡ã‚¯ã‚¨ãƒª**: `SELECT * FROM stocks_daily WHERE symbol = '7203.T' ORDER BY date DESC LIMIT 30`

## SQLAlchemy ãƒ¢ãƒ‡ãƒ«å®šç¾©

### Pythonå®Ÿè£…ä¾‹

```python
from sqlalchemy import Column, Integer, String, Date, Numeric, BigInteger, DateTime, UniqueConstraint, CheckConstraint, Index
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.sql import func

Base = declarative_base()

class StockDaily(Base):
    __tablename__ = 'stocks_daily'
    
    # ã‚«ãƒ©ãƒ å®šç¾©
    id = Column(Integer, primary_key=True, autoincrement=True)
    symbol = Column(String(20), nullable=False)
    date = Column(Date, nullable=False)
    open = Column(Numeric(10, 2), nullable=False)
    high = Column(Numeric(10, 2), nullable=False)
    low = Column(Numeric(10, 2), nullable=False)
    close = Column(Numeric(10, 2), nullable=False)
    volume = Column(BigInteger, nullable=False)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), server_default=func.now(), onupdate=func.now())
    
    # åˆ¶ç´„å®šç¾©
    __table_args__ = (
        # ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„
        UniqueConstraint('symbol', 'date', name='uk_stocks_daily_symbol_date'),
        
        # ãƒã‚§ãƒƒã‚¯åˆ¶ç´„
        CheckConstraint('open >= 0 AND high >= 0 AND low >= 0 AND close >= 0', name='ck_stocks_daily_prices'),
        CheckConstraint('volume >= 0', name='ck_stocks_daily_volume'),
        CheckConstraint('high >= low AND high >= open AND high >= close AND low <= open AND low <= close', name='ck_stocks_daily_price_logic'),
        
        # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
        Index('idx_stocks_daily_symbol', 'symbol'),
        Index('idx_stocks_daily_date', 'date'),
        Index('idx_stocks_daily_symbol_date_desc', 'symbol', 'date', postgresql_desc=True),
    )
    
    def __repr__(self):
        return f"<StockDaily(symbol='{self.symbol}', date='{self.date}', close={self.close})>"
```

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ

```sql
-- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
CREATE DATABASE stock_data_system;

-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼ˆé–‹ç™ºç”¨ï¼‰
CREATE USER stock_user WITH PASSWORD 'stock_password';
GRANT ALL PRIVILEGES ON DATABASE stock_data_system TO stock_user;
```

### 2. ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ

```sql
-- stocks_daily ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆæ—¥è¶³ãƒ‡ãƒ¼ã‚¿ï¼‰
CREATE TABLE stocks_daily (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(20) NOT NULL,
    date DATE NOT NULL,
    open DECIMAL(10,2) NOT NULL,
    high DECIMAL(10,2) NOT NULL,
    low DECIMAL(10,2) NOT NULL,
    close DECIMAL(10,2) NOT NULL,
    volume BIGINT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    
    -- åˆ¶ç´„
    CONSTRAINT uk_stocks_daily_symbol_date UNIQUE (symbol, date),
    CONSTRAINT ck_stocks_daily_prices CHECK (open >= 0 AND high >= 0 AND low >= 0 AND close >= 0),
    CONSTRAINT ck_stocks_daily_volume CHECK (volume >= 0),
    CONSTRAINT ck_stocks_daily_price_logic CHECK (
        high >= low AND 
        high >= open AND 
        high >= close AND 
        low <= open AND 
        low <= close
    )
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
CREATE INDEX idx_stocks_daily_symbol ON stocks_daily (symbol);
CREATE INDEX idx_stocks_daily_date ON stocks_daily (date);
CREATE INDEX idx_stocks_daily_symbol_date_desc ON stocks_daily (symbol, date DESC);
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹è€ƒæ…®äº‹é …

### MVPæ®µéšŽã§ã®æ–¹é‡

- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: å¿…è¦æœ€å°é™ã®ã¿ä½œæˆ
- **ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³**: ç¾æ™‚ç‚¹ã§ã¯ä¸è¦ï¼ˆãƒ‡ãƒ¼ã‚¿é‡ãŒå°‘ãªã„ãŸã‚ï¼‰
- **æœ€é©åŒ–**: å‹•ä½œç¢ºèªå¾Œã«æ¤œè¨Ž

### å°†æ¥ã®æ‹¡å¼µæ¡ˆï¼ˆå¿…è¦ã«ãªã£ã¦ã‹ã‚‰æ¤œè¨Žï¼‰

- **ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³**: æ—¥ä»˜åˆ¥ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³
- **èª­ã¿å–ã‚Šå°‚ç”¨ãƒ¬ãƒ—ãƒªã‚«**: åˆ†æžç”¨é€”
- **ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–**: å¤ã„ãƒ‡ãƒ¼ã‚¿ã®åˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ç§»å‹•

## ãƒ‡ãƒ¼ã‚¿å®¹é‡è¦‹ç©ã‚‚ã‚Š

### 1éŠ˜æŸ„ã‚ãŸã‚Šã®ãƒ‡ãƒ¼ã‚¿é‡

- 1æ—¥1ãƒ¬ã‚³ãƒ¼ãƒ‰: ç´„ 100 bytes
- 1å¹´ï¼ˆç´„250å–¶æ¥­æ—¥ï¼‰: 25 KB
- 10å¹´: 250 KB

### 100éŠ˜æŸ„ã®å ´åˆ

- 1å¹´: 2.5 MB
- 10å¹´: 25 MB

**çµè«–**: MVPæ®µéšŽã§ã¯å®¹é‡ã‚’æ°—ã«ã™ã‚‹å¿…è¦ãªã—

## ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»é‹ç”¨

### MVPæ®µéšŽã§ã®æ–¹é‡

- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: é–‹ç™ºæ®µéšŽã§ã¯æœ€å°é™
- **ç›£è¦–**: åŸºæœ¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ã¿
- **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹**: å¿…è¦ã«ãªã£ã¦ã‹ã‚‰æ¤œè¨Ž

### å°†æ¥ã®é‹ç”¨è¨ˆç”»ï¼ˆå¿…è¦ã«ãªã£ã¦ã‹ã‚‰ï¼‰

- å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ç›£è¦–
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

## ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŒ¿å…¥ä¾‹

```sql
-- ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æŒ¿å…¥ï¼ˆæ—¥è¶³ãƒ‡ãƒ¼ã‚¿ï¼‰
INSERT INTO stocks_daily (symbol, date, open, high, low, close, volume) VALUES
('7203.T', '2024-09-09', 2500.00, 2550.00, 2480.00, 2530.00, 1500000),
('7203.T', '2024-09-08', 2480.00, 2520.00, 2460.00, 2500.00, 1200000),
('7203.T', '2024-09-07', 2450.00, 2490.00, 2430.00, 2480.00, 1100000);

-- 6502.Tï¼ˆæ±èŠï¼‰ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
INSERT INTO stocks_daily (symbol, date, open, high, low, close, volume) VALUES
('6502.T', '2024-09-09', 4500.00, 4580.00, 4450.00, 4550.00, 800000),
('6502.T', '2024-09-08', 4480.00, 4520.00, 4460.00, 4500.00, 750000);
```

## å®Ÿè£…å„ªå…ˆåº¦

### å„ªå…ˆåº¦: é«˜ï¼ˆMVPå¿…é ˆï¼‰

- âœ… stocks_daily ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- âœ… åŸºæœ¬åˆ¶ç´„ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ã€ãƒã‚§ãƒƒã‚¯ï¼‰
- âœ… åŸºæœ¬ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
- âœ… SQLAlchemyãƒ¢ãƒ‡ãƒ«

### å„ªå…ˆåº¦: ä¸­ï¼ˆå‹•ä½œç¢ºèªå¾Œï¼‰

- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–
- è©³ç´°ãªãƒ­ã‚°ãƒ»ç›£è¦–
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š

### å„ªå…ˆåº¦: ä½Žï¼ˆå¿…è¦ã«ãªã£ã¦ã‹ã‚‰ï¼‰

- ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³
- ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ©Ÿèƒ½

## è¤‡æ•°æ™‚é–“è»¸å¯¾å¿œï¼ˆå°†æ¥æ‹¡å¼µï¼‰

### yfinanceã§å¯¾å¿œå¯èƒ½ãªæ™‚é–“è»¸

| æ™‚é–“è»¸ | yfinance interval | ãƒ†ãƒ¼ãƒ–ãƒ«åäºˆå®š | å®Ÿè£…å„ªå…ˆåº¦    |
| ------ | ----------------- | -------------- | ------------- |
| åˆ†è¶³   | 1m, 5m, 15m, 30m  | stocks_minute  | ä½Ž            |
| æ™‚é–“è¶³ | 1h                | stocks_hourly  | ä½Ž            |
| æ—¥è¶³   | 1d                | stocks_daily   | **é«˜ï¼ˆMVPï¼‰** |
| é€±è¶³   | 1wk               | stocks_weekly  | ä¸­            |
| æœˆè¶³   | 1mo               | stocks_monthly | ä¸­            |

### å°†æ¥ã®ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆæ¡ˆ

#### åˆ†è¶³ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå°†æ¥æ‹¡å¼µï¼‰
```sql
CREATE TABLE stocks_minute (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(20) NOT NULL,
    datetime TIMESTAMP WITH TIME ZONE NOT NULL,  -- åˆ†è¶³ã¯æ—¥æ™‚ãŒå¿…è¦
    open DECIMAL(10,2) NOT NULL,
    high DECIMAL(10,2) NOT NULL,
    low DECIMAL(10,2) NOT NULL,
    close DECIMAL(10,2) NOT NULL,
    volume BIGINT NOT NULL,
    interval_type VARCHAR(5) NOT NULL,  -- '1m', '5m', '15m', '30m'
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    
    -- åˆ¶ç´„
    CONSTRAINT uk_stocks_minute_symbol_datetime_interval UNIQUE (symbol, datetime, interval_type),
    CONSTRAINT ck_stocks_minute_prices CHECK (open >= 0 AND high >= 0 AND low >= 0 AND close >= 0),
    CONSTRAINT ck_stocks_minute_volume CHECK (volume >= 0),
    CONSTRAINT ck_stocks_minute_price_logic CHECK (
        high >= low AND high >= open AND high >= close AND low <= open AND low <= close
    )
);
```

#### é€±è¶³ãƒ»æœˆè¶³ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå°†æ¥æ‹¡å¼µï¼‰
```sql
CREATE TABLE stocks_weekly (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(20) NOT NULL,
    date DATE NOT NULL,  -- é€±ã®é–‹å§‹æ—¥
    open DECIMAL(10,2) NOT NULL,
    high DECIMAL(10,2) NOT NULL,
    low DECIMAL(10,2) NOT NULL,
    close DECIMAL(10,2) NOT NULL,
    volume BIGINT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT uk_stocks_weekly_symbol_date UNIQUE (symbol, date)
);

CREATE TABLE stocks_monthly (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(20) NOT NULL,
    date DATE NOT NULL,  -- æœˆã®é–‹å§‹æ—¥
    open DECIMAL(10,2) NOT NULL,
    high DECIMAL(10,2) NOT NULL,
    low DECIMAL(10,2) NOT NULL,
    close DECIMAL(10,2) NOT NULL,
    volume BIGINT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT uk_stocks_monthly_symbol_date UNIQUE (symbol, date)
);
```

### è¨­è¨ˆæ–¹é‡

#### MVPæ®µéšŽï¼ˆç¾åœ¨ï¼‰
- **æ—¥è¶³ã®ã¿å®Ÿè£…**: stocks_daily ãƒ†ãƒ¼ãƒ–ãƒ«
- **ã‚·ãƒ³ãƒ—ãƒ«è¨­è¨ˆ**: è¤‡é›‘ãªçµ±åˆã¯é¿ã‘ã‚‹
- **å‹•ä½œå„ªå…ˆ**: ã¾ãšæ—¥è¶³ã§å‹•ä½œç¢ºèª

#### å°†æ¥æ‹¡å¼µæ™‚
- **ãƒ†ãƒ¼ãƒ–ãƒ«åˆ†é›¢**: æ™‚é–“è»¸ã”ã¨ã«ç‹¬ç«‹ã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«
- **å…±é€šã‚¹ã‚­ãƒ¼ãƒž**: åŸºæœ¬æ§‹é€ ã¯çµ±ä¸€
- **æ®µéšŽçš„è¿½åŠ **: å¿…è¦ã«ãªã£ãŸæ™‚é–“è»¸ã‹ã‚‰é †æ¬¡è¿½åŠ 

### æ‹¡å¼µæ™‚ã®è€ƒæ…®äº‹é …

#### ãƒ‡ãƒ¼ã‚¿é‡
- **åˆ†è¶³**: å¤§å®¹é‡ï¼ˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³å¿…è¦ï¼‰
- **æ—¥è¶³**: ä¸­å®¹é‡ï¼ˆç¾åœ¨ã®è¨­è¨ˆã§å¯¾å¿œå¯èƒ½ï¼‰
- **é€±è¶³ãƒ»æœˆè¶³**: å°å®¹é‡ï¼ˆå•é¡Œãªã—ï¼‰

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹
- **åˆ†è¶³**: å°‚ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ»ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³å¿…è¦
- **æ—¥è¶³**: ç¾åœ¨ã®è¨­è¨ˆã§ååˆ†
- **é€±è¶³ãƒ»æœˆè¶³**: ç¾åœ¨ã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã§å¯¾å¿œå¯èƒ½

#### APIè¨­è¨ˆã¸ã®å½±éŸ¿
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/api/stocks/daily`, `/api/stocks/minute` ãªã©
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: interval æŒ‡å®šã®è¿½åŠ 
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: æ™‚é–“è»¸ã«å¿œã˜ãŸãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ

---

## ã¾ã¨ã‚

### ðŸŽ¯ **å€‹äºº+AIé–‹ç™ºã§ã®ã‚·ãƒ³ãƒ—ãƒ«DBè¨­è¨ˆ**

#### è¨­è¨ˆæ–¹é‡
1. **æœ€å°é™ã§é–‹å§‹**: 1ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å§‹ã‚ã‚‹
2. **å‹•ä½œå„ªå…ˆ**: è¤‡é›‘ãªæœ€é©åŒ–ã‚ˆã‚Šç¢ºå®Ÿãªå‹•ä½œ
3. **æ®µéšŽçš„æ‹¡å¼µ**: å¿…è¦ã«ãªã£ã¦ã‹ã‚‰æ©Ÿèƒ½è¿½åŠ 

#### é¿ã‘ã‚‹ã¹ãéŽåº¦ãªè¨­è¨ˆ
- è¤‡é›‘ãªãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 
- éŽåº¦ãªæ­£è¦åŒ–
- ä¸è¦ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
- è¤‡é›‘ãªåˆ¶ç´„

#### æˆåŠŸã®æŒ‡æ¨™
- ãƒ‡ãƒ¼ã‚¿ã®ç¢ºå®Ÿãªä¿å­˜ãƒ»å–å¾—
- åŸºæœ¬çš„ãªã‚¯ã‚¨ãƒªã®é«˜é€Ÿå‹•ä½œ
- ç°¡æ½”ã§ç†è§£ã—ã‚„ã™ã„ã‚¹ã‚­ãƒ¼ãƒž

ã“ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã«ã‚ˆã‚Šã€**å‹•ä½œã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚’ç´ æ—©ãæ§‹ç¯‰**ã—ã€**å¿…è¦ã«å¿œã˜ã¦é€²åŒ–**ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
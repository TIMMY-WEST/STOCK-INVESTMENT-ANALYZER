---
category: development
ai_context: high
last_updated: 2025-10-23
related_docs:
  - ./git_workflow.md
  - ./github_workflow.md
  - ./coding_standards.md
  - ./testing_guide.md
---

# コードレビューガイドライン

## 目次

- [コードレビューガイドライン](#コードレビューガイドライン)
  - [目次](#目次)
  - [1. 概要](#1-概要)
    - [1.1 目的](#11-目的)
    - [1.2 対象読者](#12-対象読者)
    - [1.3 関連ドキュメント](#13-関連ドキュメント)
  - [2. コードレビューの目的と重要性](#2-コードレビューの目的と重要性)
    - [2.1 主な目的](#21-主な目的)
    - [2.2 期待される効果](#22-期待される効果)
    - [2.3 レビュー文化の重要性](#23-レビュー文化の重要性)
  - [3. レビュアーの心得](#3-レビュアーの心得)
    - [3.1 基本姿勢](#31-基本姿勢)
    - [3.2 タイムリーなレビュー](#32-タイムリーなレビュー)
    - [3.3 建設的なフィードバック](#33-建設的なフィードバック)
    - [3.4 レビューの優先度](#34-レビューの優先度)
    - [3.5 レビューコメントの書き方](#35-レビューコメントの書き方)
  - [4. PR作成者の心得](#4-pr作成者の心得)
    - [4.1 基本姿勢](#41-基本姿勢)
    - [4.2 小さなPRの作成（500行以下推奨）](#42-小さなprの作成500行以下推奨)
    - [4.3 PR作成前のセルフチェック](#43-pr作成前のセルフチェック)
    - [4.4 分かりやすいPR説明](#44-分かりやすいpr説明)
    - [4.5 フィードバックへの対応](#45-フィードバックへの対応)
  - [5. レビュー観点チェックリスト](#5-レビュー観点チェックリスト)
    - [5.1 機能要件](#51-機能要件)
    - [5.2 コード品質](#52-コード品質)
    - [5.3 テスト](#53-テスト)
    - [5.4 セキュリティ](#54-セキュリティ)
    - [5.5 パフォーマンス](#55-パフォーマンス)
    - [5.6 保守性](#56-保守性)
    - [5.7 ドキュメント](#57-ドキュメント)
  - [6. レビュープロセス](#6-レビュープロセス)
    - [6.1 レビューフロー](#61-レビューフロー)
    - [6.2 レビュー時間の目安](#62-レビュー時間の目安)
    - [6.3 レビューの承認基準](#63-レビューの承認基準)
    - [6.4 変更要求の基準](#64-変更要求の基準)
  - [7. 効果的なコードレビューのコツ](#7-効果的なコードレビューのコツ)
    - [7.1 レビュアー向け](#71-レビュアー向け)
    - [7.2 PR作成者向け](#72-pr作成者向け)
  - [8. コメントの優先度と表現](#8-コメントの優先度と表現)
    - [8.1 優先度の分類](#81-優先度の分類)
    - [8.2 推奨される表現例](#82-推奨される表現例)
    - [8.3 避けるべき表現](#83-避けるべき表現)
  - [9. トラブルシューティング](#9-トラブルシューティング)
    - [9.1 意見の対立が発生した場合](#91-意見の対立が発生した場合)
    - [9.2 レビューが滞っている場合](#92-レビューが滞っている場合)
    - [9.3 大規模なPRの場合](#93-大規模なprの場合)
  - [10. ベストプラクティス](#10-ベストプラクティス)
    - [10.1 やるべきこと ✅](#101-やるべきこと-)
    - [10.2 避けるべきこと ❌](#102-避けるべきこと-)
  - [11. 参考資料](#11-参考資料)

## 1. 概要

### 1.1 目的

本ドキュメントは、STOCK-INVESTMENT-ANALYZERプロジェクトにおける効果的なコードレビューのためのガイドラインを提供します。

### 1.2 対象読者

- プロジェクトの全開発メンバー
- コードレビュアー
- Pull Request作成者

### 1.3 関連ドキュメント

- [Git運用ワークフロー](./git_workflow.md): ブランチ戦略とコミット規約
- [GitHub運用ワークフロー](./github_workflow.md): 個人+AI開発向けワークフロー
- [コーディング規約](./coding_standards.md): コーディングスタイルとベストプラクティス
- [テストガイド](./testing_guide.md): テスト作成のガイドライン

## 2. コードレビューの目的と重要性

### 2.1 主な目的

コードレビューは以下の目的を持ちます:

1. **品質向上**: バグやセキュリティ脆弱性の早期発見
2. **知識共有**: チームメンバー間での技術スキルやドメイン知識の共有
3. **一貫性維持**: コーディング規約やアーキテクチャの一貫性の確保
4. **メンタリング**: 経験豊富なメンバーから学ぶ機会の提供
5. **品質保証**: テストカバレッジや仕様への適合の確認

### 2.2 期待される効果

- コードの可読性・保守性の向上
- バグの早期発見とコスト削減
- チーム全体のスキルアップ
- コードベースへの理解度向上
- より良い設計やアーキテクチャへの改善

### 2.3 レビュー文化の重要性

効果的なコードレビューには、以下のような健全なレビュー文化が不可欠です:

- **相互尊重**: レビューはコードに対するものであり、個人攻撃ではない
- **学びの姿勢**: 全員が学び、成長するための機会
- **建設的対話**: 問題を指摘するだけでなく、解決策を提案
- **心理的安全性**: 質問や提案がしやすい雰囲気

## 3. レビュアーの心得

### 3.1 基本姿勢

**Do's:**
- コードの品質向上を最優先に考える
- 作成者の努力を認め、敬意を持って接する
- 「なぜ」という理由を説明する
- 具体的な改善案を提示する
- コードの良い点も積極的に褒める

**Don'ts:**
- 個人攻撃や批判的な言葉を使わない
- 曖昧な指摘をしない
- 完璧を求めすぎない
- 自分のスタイルを押し付けない

### 3.2 タイムリーなレビュー

**24時間以内のレビュー対応を推奨**

- **優先度**: レビューは現在の作業の次に優先
- **理由**:
  - PR作成者の作業がブロックされる
  - コンテキストスイッチのコストが増大
  - チームの生産性に直結
- **対応できない場合**:
  - レビュー依頼を受けた時点で見積もり時間を伝える
  - 他のレビュアーへの依頼を提案

### 3.3 建設的なフィードバック

**良い例:**
```markdown
💡 提案: この部分は `get_stock_data()` メソッドに切り出すと、
テストしやすくなり、可読性も向上すると思います。

例:
def get_stock_data(symbol: str) -> dict:
    """株価データを取得する"""
    # ...
```

**悪い例:**
```markdown
❌ この書き方は良くないです。
```

### 3.4 レビューの優先度

レビューは以下の順序で確認します:

1. **Critical**: セキュリティ、データ損失、重大なバグ
2. **High**: 機能要件、アーキテクチャ設計
3. **Medium**: コード品質、テストカバレッジ
4. **Low**: コードスタイル、命名規則、細かいリファクタリング

### 3.5 レビューコメントの書き方

**基本構造:**

```
[優先度] [観点]: [具体的な指摘]

[理由の説明]

[改善案（オプション）]
```

**例:**

```markdown
🔴 Critical (Security): APIキーがハードコーディングされています

環境変数から読み込むようにしてください。

推奨:
api_key = os.environ.get('API_KEY')
if not api_key:
    raise ValueError("API_KEY environment variable is required")
```

## 4. PR作成者の心得

### 4.1 基本姿勢

**Do's:**
- レビューのフィードバックを学びの機会と捉える
- 質問や指摘に対して防御的にならない
- 理解できない指摘は積極的に質問する
- レビュアーの時間を尊重する
- 自分で解決できる問題は事前に対応

**Don'ts:**
- フィードバックを個人攻撃と受け取らない
- レビューコメントを無視しない
- 「動くから良い」という姿勢を取らない
- レビュアーの指摘に感情的に反応しない

### 4.2 小さなPRの作成（500行以下推奨）

**推奨サイズ:**
- **理想**: 200-300行
- **最大**: 500行
- **それ以上**: 分割を検討

**小さいPRのメリット:**
- レビューが早く終わる
- バグの発見が容易
- 変更の影響範囲が明確
- レビュアーの負担が少ない
- マージ後の問題の切り分けが容易

**大きなPRを避けるための工夫:**
- 機能を段階的に実装
- リファクタリングと機能追加を分離
- 設計変更は別PRで実施
- 必要に応じてFeature Flagを使用

### 4.3 PR作成前のセルフチェック

提出前に必ず確認:

- [ ] **機能要件**: Issue要件を満たしている
- [ ] **動作確認**: ローカル環境で正常動作を確認
- [ ] **テスト**: テストが実装され、全て通過している
- [ ] **コーディング規約**: プロジェクトの規約に準拠
- [ ] **ドキュメント**: 必要なドキュメントを更新
- [ ] **セキュリティ**: セキュリティの観点で問題がない
- [ ] **パフォーマンス**: パフォーマンスに悪影響がない
- [ ] **依存関係**: 不要な依存関係を追加していない
- [ ] **デバッグコード**: console.log、print文などを削除
- [ ] **コミット**: Conventional Commits規約に準拠

### 4.4 分かりやすいPR説明

**必須項目:**

```markdown
## 概要
この変更の目的と背景を簡潔に説明

## 変更内容
- 主要な変更点をリストアップ
- アーキテクチャや設計上の決定事項

## テスト方法
1. 具体的なテスト手順
2. 確認すべき動作

## 影響範囲
- 影響を受けるコンポーネント
- 破壊的変更の有無

## レビューポイント
特に注目してほしい箇所

## スクリーンショット（該当する場合）
UI変更の場合は追加

## 関連Issue
Closes #123
```

### 4.5 フィードバックへの対応

**対応の原則:**

1. **理解の確認**: 指摘内容を正確に理解する
2. **質問**: 不明点は遠慮なく質問
3. **迅速な対応**: 可能な限り早く修正を反映
4. **コミュニケーション**: 対応が難しい場合は理由を説明

**コメント返信のテンプレート:**

```markdown
✅ 修正しました: [コミットハッシュ]

📝 質問: [理解できなかった点]

💭 代替案: [別の実装方法の提案]

⏰ 対応予定: [すぐに対応できない理由と予定]
```

## 5. レビュー観点チェックリスト

### 5.1 機能要件

- [ ] Issueの要件を満たしているか
- [ ] 期待通りの動作をするか
- [ ] エッジケースに対応しているか
- [ ] エラーハンドリングが適切か

### 5.2 コード品質

- [ ] コードが読みやすく理解しやすいか
- [ ] 適切な抽象化レベルか
- [ ] 重複コードがないか（DRY原則）
- [ ] 単一責任の原則に従っているか
- [ ] 命名が適切で分かりやすいか
- [ ] マジックナンバーを使用していないか
- [ ] 適切なデザインパターンを使用しているか

### 5.3 テスト

- [ ] ユニットテストが実装されているか
- [ ] テストカバレッジが十分か
- [ ] テストケースは適切か（正常系・異常系）
- [ ] テストが独立しているか
- [ ] テストが保守しやすいか

### 5.4 セキュリティ

- [ ] 認証・認可が適切に実装されているか
- [ ] 入力値のバリデーションがあるか
- [ ] SQLインジェクション対策がされているか
- [ ] XSS対策がされているか
- [ ] 機密情報がログに出力されていないか
- [ ] APIキーなどがハードコーディングされていないか

### 5.5 パフォーマンス

- [ ] 不要なデータベースクエリがないか
- [ ] N+1問題が発生していないか
- [ ] メモリリークの可能性がないか
- [ ] 適切なキャッシング戦略か
- [ ] 大量データでもスケールするか

### 5.6 保守性

- [ ] コメントが適切に記載されているか
- [ ] 複雑なロジックに説明があるか
- [ ] 型ヒントが適切に使用されているか
- [ ] 将来の拡張を考慮した設計か
- [ ] 技術的負債を増やしていないか

### 5.7 ドキュメント

- [ ] APIドキュメントが更新されているか
- [ ] READMEが必要に応じて更新されているか
- [ ] 複雑な仕様の説明があるか
- [ ] 変更に伴う影響が記載されているか

## 6. レビュープロセス

### 6.1 レビューフロー

```
┌────────────────────────────────────────────────────────┐
│              コードレビューフロー                      │
├────────────────────────────────────────────────────────┤
│                                                        │
│  1. PR作成                                             │
│     └─ セルフレビュー・CI確認                          │
│                                                        │
│  2. レビュー依頼                                       │
│     └─ 適切なレビュアーを指定                          │
│                                                        │
│  3. レビュー実施（24時間以内）                         │
│     ├─ コード確認                                      │
│     ├─ コメント記載                                    │
│     └─ 承認 or 変更要求                                │
│                                                        │
│  4. フィードバック対応                                 │
│     ├─ 指摘事項の修正                                  │
│     └─ 再レビュー依頼                                  │
│                                                        │
│  5. 最終承認                                           │
│     └─ マージ実施                                      │
│                                                        │
└────────────────────────────────────────────────────────┘
```

### 6.2 レビュー時間の目安

| PRサイズ | 変更行数 | レビュー時間 | レビュー回数 |
|---------|---------|------------|------------|
| **Small** | ~100行 | 15-30分 | 1-2回 |
| **Medium** | 100-300行 | 30-60分 | 2-3回 |
| **Large** | 300-500行 | 1-2時間 | 3-4回 |
| **XLarge** | 500行~ | 分割推奨 | 分割推奨 |

### 6.3 レビューの承認基準

**承認できる条件:**
- 全ての機能要件を満たしている
- テストが適切に実装され、全て通過
- セキュリティ上の問題がない
- コーディング規約に準拠
- ドキュメントが更新されている
- 重大な技術的負債を生まない

**Minor Issues（軽微な問題）がある場合:**
- 承認しつつ、後続Issueで対応を提案
- 「Approve with comments」として承認

### 6.4 変更要求の基準

以下の場合は「Request Changes」として変更を要求:

- **Critical/High優先度の問題**:
  - セキュリティ脆弱性
  - 重大なバグ
  - アーキテクチャ上の問題
  - 機能要件の未達成

- **ブロックする理由の明示**:
  - なぜ変更が必要か明確に説明
  - 具体的な改善案を提示

## 7. 効果的なコードレビューのコツ

### 7.1 レビュアー向け

**レビューの進め方:**

1. **PR説明を読む**: 変更の目的と背景を理解
2. **全体像を把握**: 変更の影響範囲を確認
3. **詳細をレビュー**: コードを行ごとに確認
4. **動作確認**: 可能であればローカルで実行
5. **フィードバック**: 建設的なコメントを記載

**効率的なレビューのヒント:**

- 集中できる時間帯に実施
- 一度に長時間レビューしない（最大60分）
- 疑問点はすぐに質問
- 良いコードには積極的に「👍」「LGTM」
- 学んだことはメモしておく

### 7.2 PR作成者向け

**レビューを受けやすくする工夫:**

1. **コンテキストを提供**:
   - なぜこの実装を選んだか
   - 検討した代替案
   - トレードオフの判断理由

2. **セルフレビュー**:
   - 提出前に自分でコードを確認
   - GitHub上でdiffを確認
   - 不明瞭な部分にコメント追加

3. **段階的な実装**:
   - 大きな変更は複数PRに分割
   - 依存関係を明確に

4. **レビューコメントへの対応**:
   - 「Fix」だけでなく、何を修正したか説明
   - 対応完了したら「✅」マークで明示

## 8. コメントの優先度と表現

### 8.1 優先度の分類

| アイコン | 優先度 | 説明 | 例 |
|---------|-------|------|---|
| 🔴 | **Critical** | 必ず修正が必要（セキュリティ、バグ） | セキュリティ脆弱性、データ損失 |
| 🟡 | **High** | 修正を強く推奨（設計、アーキテクチャ） | アーキテクチャ違反、重大な非効率 |
| 🔵 | **Medium** | 修正が望ましい（品質、保守性） | テストカバレッジ、リファクタリング |
| ⚪ | **Low/Nit** | 修正は任意（スタイル、細かい改善） | 命名、コメント、フォーマット |
| 💡 | **Suggestion** | 提案・アイデア | より良い実装方法の提案 |
| ❓ | **Question** | 質問・確認 | 意図の確認、理解の深化 |
| 👍 | **Praise** | 良い実装の称賛 | 良い設計、分かりやすいコード |

### 8.2 推奨される表現例

**質問形式:**
```markdown
❓ この部分で `list` ではなく `set` を使用している理由は何でしょうか?
順序が重要な場合は問題ありませんが、重複除去が目的であれば `set` が適しているかもしれません。
```

**提案形式:**
```markdown
💡 提案: エラーハンドリングをより具体的にすると、デバッグが容易になると思います。

現在:
except Exception as e:
    logger.error(f"Error: {e}")

提案:
except ValueError as e:
    logger.error(f"Invalid value: {e}")
except ConnectionError as e:
    logger.error(f"Connection failed: {e}")
```

**称賛:**
```markdown
👍 このエラーハンドリングは非常に分かりやすいですね!
エラーメッセージも具体的で、トラブルシューティングがしやすそうです。
```

### 8.3 避けるべき表現

❌ **悪い例:**
- "これは間違っています"
- "なぜこんな書き方をするのですか?"
- "こんなコードは読めません"
- "常識的に考えて..."

✅ **良い例:**
- "この実装だと〇〇の問題が発生する可能性があります。△△のように修正してはどうでしょうか?"
- "この書き方の意図を教えていただけますか?"
- "この部分の可読性を向上させるため、〇〇を提案します"
- "プロジェクトの規約では△△を推奨しています"

## 9. トラブルシューティング

### 9.1 意見の対立が発生した場合

**対処手順:**

1. **一対一で議論**: コメント欄での長い議論は避ける
2. **根拠を明確に**: それぞれの意見の根拠を説明
3. **第三者の意見**: 必要に応じて他のメンバーに相談
4. **判断基準**:
   - プロジェクトの方針・規約
   - 保守性・拡張性
   - パフォーマンス
   - 工数とのバランス

5. **決定事項の記録**: 議論の結果をドキュメント化

### 9.2 レビューが滞っている場合

**対処方法:**

- **24時間経過**: リマインダーを送る
- **48時間経過**: 他のレビュアーを追加
- **3日経過**: プロジェクトリーダーに相談

**予防策:**
- レビュアーの負荷分散
- レビュー可能時間の明示
- 緊急度の明確化

### 9.3 大規模なPRの場合

**対処方法:**

1. **分割可能か検討**:
   - 機能単位で分割
   - リファクタリングと機能追加を分離

2. **段階的レビュー**:
   - 高優先度の部分から順次レビュー
   - 複数回に分けてレビュー

3. **ペアレビュー**:
   - 画面共有でレビュー
   - リアルタイムで質疑応答

## 10. ベストプラクティス

### 10.1 やるべきこと ✅

**レビュアー:**
- ✅ 24時間以内にレビューを開始
- ✅ コードの良い点も積極的に褒める
- ✅ 具体的な改善案を提示
- ✅ 質問は遠慮なく行う
- ✅ 優先度を明示する
- ✅ 建設的で丁寧な言葉遣い

**PR作成者:**
- ✅ 小さなPRを心がける（500行以下）
- ✅ 詳細なPR説明を記載
- ✅ セルフレビューを実施
- ✅ テストを十分に実装
- ✅ フィードバックに迅速に対応
- ✅ 学びの姿勢を持つ

### 10.2 避けるべきこと ❌

**レビュアー:**
- ❌ レビューを後回しにする
- ❌ 批判的・攻撃的なコメント
- ❌ 曖昧な指摘
- ❌ 自分のスタイルの押し付け
- ❌ 完璧主義
- ❌ スタイルだけの指摘で変更要求

**PR作成者:**
- ❌ 大きすぎるPR（500行超）
- ❌ 不十分なPR説明
- ❌ テストなしでの提出
- ❌ フィードバックを無視
- ❌ 防御的な態度
- ❌ 「動くから良い」という姿勢

## 11. 参考資料

### 外部リソース

- [Google Engineering Practices - Code Review](https://google.github.io/eng-practices/review/)
- [Conventional Comments](https://conventionalcomments.org/)
- [The Art of Code Review](https://github.com/thoughtbot/guides/tree/main/code-review)

### プロジェクト内ドキュメント

- [Git運用ワークフロー](./git_workflow.md)
- [GitHub運用ワークフロー](./github_workflow.md)
- [コーディング規約](./coding_standards.md)
- [テストガイド](./testing_guide.md)
- [テスト戦略](./testing_strategy.md)

---

**更新履歴:**
- 2025-10-23: 初版作成（Issue #115対応）

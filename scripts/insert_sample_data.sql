-- =============================================================================
-- PostgreSQL サンプルデータ投入スクリプト
-- 株価データ取得システム用テストデータ作成
-- =============================================================================

-- セッション設定
SET client_encoding = 'UTF8';
SET timezone = 'Asia/Tokyo';

-- 現在の接続情報を確認
SELECT
    current_database() as "接続中のデータベース",
    current_user as "現在のユーザー";

-- =============================================================================
-- 既存データのクリーンアップ（開発環境用）
-- =============================================================================

-- 注意: この操作は全データを削除します。本番環境では実行しないでください。
-- DELETE FROM stocks_daily;

-- =============================================================================
-- トヨタ自動車（7203.T）のサンプルデータ
-- =============================================================================

INSERT INTO stocks_daily (symbol, date, open, high, low, close, volume) VALUES
-- 2024年9月第2週のデータ
('7203.T', '2024-09-09', 2500.00, 2550.00, 2480.00, 2530.00, 1500000),
('7203.T', '2024-09-10', 2530.00, 2580.00, 2520.00, 2570.00, 1350000),
('7203.T', '2024-09-11', 2570.00, 2600.00, 2550.00, 2590.00, 1200000),
('7203.T', '2024-09-12', 2590.00, 2620.00, 2580.00, 2610.00, 1100000),
('7203.T', '2024-09-13', 2610.00, 2650.00, 2600.00, 2635.00, 1400000),

-- 2024年9月第1週のデータ
('7203.T', '2024-09-02', 2450.00, 2480.00, 2430.00, 2460.00, 1600000),
('7203.T', '2024-09-03', 2460.00, 2490.00, 2440.00, 2475.00, 1550000),
('7203.T', '2024-09-04', 2475.00, 2510.00, 2465.00, 2495.00, 1450000),
('7203.T', '2024-09-05', 2495.00, 2520.00, 2485.00, 2500.00, 1300000),
('7203.T', '2024-09-06', 2500.00, 2530.00, 2490.00, 2500.00, 1250000);

-- =============================================================================
-- ソニーグループ（6758.T）のサンプルデータ
-- =============================================================================

INSERT INTO stocks_daily (symbol, date, open, high, low, close, volume) VALUES
-- 2024年9月第2週のデータ
('6758.T', '2024-09-09', 12500.00, 12800.00, 12450.00, 12750.00, 800000),
('6758.T', '2024-09-10', 12750.00, 12900.00, 12700.00, 12850.00, 750000),
('6758.T', '2024-09-11', 12850.00, 12950.00, 12800.00, 12900.00, 720000),
('6758.T', '2024-09-12', 12900.00, 12980.00, 12880.00, 12950.00, 680000),
('6758.T', '2024-09-13', 12950.00, 13050.00, 12920.00, 13000.00, 850000),

-- 2024年9月第1週のデータ
('6758.T', '2024-09-02', 12200.00, 12300.00, 12150.00, 12250.00, 900000),
('6758.T', '2024-09-03', 12250.00, 12350.00, 12200.00, 12300.00, 870000),
('6758.T', '2024-09-04', 12300.00, 12400.00, 12280.00, 12380.00, 820000),
('6758.T', '2024-09-05', 12380.00, 12450.00, 12360.00, 12420.00, 780000),
('6758.T', '2024-09-06', 12420.00, 12500.00, 12400.00, 12500.00, 760000);

-- =============================================================================
-- 三菱UFJフィナンシャル・グループ（8306.T）のサンプルデータ
-- =============================================================================

INSERT INTO stocks_daily (symbol, date, open, high, low, close, volume) VALUES
-- 2024年9月第2週のデータ
('8306.T', '2024-09-09', 1350.00, 1380.00, 1340.00, 1370.00, 5500000),
('8306.T', '2024-09-10', 1370.00, 1390.00, 1365.00, 1385.00, 5200000),
('8306.T', '2024-09-11', 1385.00, 1400.00, 1375.00, 1395.00, 4800000),
('8306.T', '2024-09-12', 1395.00, 1410.00, 1390.00, 1405.00, 4600000),
('8306.T', '2024-09-13', 1405.00, 1420.00, 1400.00, 1415.00, 5100000),

-- 2024年9月第1週のデータ
('8306.T', '2024-09-02', 1300.00, 1320.00, 1295.00, 1315.00, 6000000),
('8306.T', '2024-09-03', 1315.00, 1330.00, 1310.00, 1325.00, 5800000),
('8306.T', '2024-09-04', 1325.00, 1340.00, 1320.00, 1335.00, 5500000),
('8306.T', '2024-09-05', 1335.00, 1350.00, 1330.00, 1345.00, 5300000),
('8306.T', '2024-09-06', 1345.00, 1360.00, 1340.00, 1350.00, 5100000);

-- =============================================================================
-- 任天堂（7974.T）のサンプルデータ
-- =============================================================================

INSERT INTO stocks_daily (symbol, date, open, high, low, close, volume) VALUES
-- 2024年9月第2週のデータ
('7974.T', '2024-09-09', 6500.00, 6580.00, 6480.00, 6550.00, 450000),
('7974.T', '2024-09-10', 6550.00, 6620.00, 6530.00, 6600.00, 420000),
('7974.T', '2024-09-11', 6600.00, 6650.00, 6580.00, 6630.00, 400000),
('7974.T', '2024-09-12', 6630.00, 6680.00, 6610.00, 6660.00, 380000),
('7974.T', '2024-09-13', 6660.00, 6720.00, 6640.00, 6700.00, 500000),

-- 2024年9月第1週のデータ
('7974.T', '2024-09-02', 6300.00, 6350.00, 6280.00, 6330.00, 520000),
('7974.T', '2024-09-03', 6330.00, 6380.00, 6310.00, 6360.00, 510000),
('7974.T', '2024-09-04', 6360.00, 6410.00, 6340.00, 6390.00, 480000),
('7974.T', '2024-09-05', 6390.00, 6440.00, 6370.00, 6420.00, 460000),
('7974.T', '2024-09-06', 6420.00, 6470.00, 6400.00, 6500.00, 450000);

-- =============================================================================
-- ファーストリテイリング（9983.T）のサンプルデータ
-- =============================================================================

INSERT INTO stocks_daily (symbol, date, open, high, low, close, volume) VALUES
-- 2024年9月第2週のデータ
('9983.T', '2024-09-09', 45000.00, 45800.00, 44500.00, 45500.00, 120000),
('9983.T', '2024-09-10', 45500.00, 46200.00, 45200.00, 46000.00, 115000),
('9983.T', '2024-09-11', 46000.00, 46500.00, 45800.00, 46300.00, 110000),
('9983.T', '2024-09-12', 46300.00, 46800.00, 46100.00, 46600.00, 105000),
('9983.T', '2024-09-13', 46600.00, 47200.00, 46400.00, 47000.00, 130000),

-- 2024年9月第1週のデータ
('9983.T', '2024-09-02', 44000.00, 44500.00, 43800.00, 44200.00, 140000),
('9983.T', '2024-09-03', 44200.00, 44700.00, 44000.00, 44500.00, 135000),
('9983.T', '2024-09-04', 44500.00, 44900.00, 44300.00, 44800.00, 125000),
('9983.T', '2024-09-05', 44800.00, 45200.00, 44600.00, 45000.00, 120000),
('9983.T', '2024-09-06', 45000.00, 45300.00, 44900.00, 45000.00, 118000);

-- =============================================================================
-- データ投入確認
-- =============================================================================

-- 投入されたデータの確認
SELECT
    symbol as "銘柄コード",
    COUNT(*) as "データ件数",
    MIN(date) as "最初の日付",
    MAX(date) as "最後の日付",
    AVG(close) as "平均終値",
    SUM(volume) as "合計出来高"
FROM stocks_daily
GROUP BY symbol
ORDER BY symbol;

-- 全データ件数確認
SELECT
    COUNT(*) as "総データ件数",
    COUNT(DISTINCT symbol) as "銘柄数",
    MIN(date) as "最古データ日付",
    MAX(date) as "最新データ日付"
FROM stocks_daily;

-- 最近のデータサンプル表示
SELECT
    symbol as "銘柄",
    date as "日付",
    close as "終値",
    volume as "出来高"
FROM stocks_daily
WHERE date >= '2024-09-10'
ORDER BY date DESC, symbol
LIMIT 10;

-- サンプルデータ投入完了メッセージ
DO $$
BEGIN
    RAISE NOTICE '=== サンプルデータ投入完了 ===';
    RAISE NOTICE '投入銘柄: トヨタ(7203.T), ソニー(6758.T), MUFG(8306.T), 任天堂(7974.T), ファーストリテイリング(9983.T)';
    RAISE NOTICE '投入期間: 2024年9月2日 ～ 2024年9月13日';
    RAISE NOTICE '各銘柄10日分のデータを投入しました';
    RAISE NOTICE 'アプリケーションからの動作確認を行ってください';
END $$;

-- =============================================================================
-- 使用方法:
-- 1. stock_data_system データベースに stock_user で接続
--    psql -U stock_user -d stock_data_system -h localhost
--
-- 2. このスクリプトを実行
--    \i scripts/insert_sample_data.sql
--
-- 3. データ確認
--    SELECT * FROM stocks_daily WHERE symbol = '7203.T' ORDER BY date DESC LIMIT 5;
-- =============================================================================